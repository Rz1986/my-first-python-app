{% extends 'base.html' %}
{% block title %}注册 · Cici 的游戏乐园{% endblock %}
{% block content %}
<section class="auth-card">
  <h1>创建你的乐园账号</h1>
  <form method="post" class="form-grid">
    <label>用户名
      <input type="text" name="username" required>
    </label>
    <label>邮箱
      <input type="email" name="email" required>
    </label>
    <div class="form-row">
      <label class="stretch">手机号
        <input type="tel" name="phone" id="phone" pattern="1\\d{10}" maxlength="11" required>
      </label>
      <button type="button" class="secondary" id="send-code">获取验证码</button>
    </div>
    <label>短信验证码
      <input type="text" name="verification_code" maxlength="6" required>
    </label>
    <label>密码
      <input type="password" name="password" required>
    </label>
    <label>确认密码
      <input type="password" name="confirm_password" required>
    </label>
    <button type="submit" class="primary">立即注册</button>
  </form>
  <p class="helper-text">已有账号？<a href="{{ url_for('login') }}">点击登录</a></p>
</section>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sendBtn = document.getElementById('send-code');
    const phoneInput = document.getElementById('phone');
    if (!sendBtn || !phoneInput) {
      return;
    }

    sendBtn.addEventListener('click', async () => {
      const phone = phoneInput.value.trim();
      if (!phone) {
        alert('请先输入手机号。');
        return;
      }
      sendBtn.disabled = true;
      sendBtn.textContent = '发送中...';
      try {
        const response = await fetch('{{ url_for('send_phone_code') }}', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ phone })
        });
        const data = await response.json();
        if (data.ok) {
          alert(`${data.message}\n验证码：${data.code}`);
        } else {
          alert(data.message || '验证码发送失败，请稍后再试。');
        }
      } catch (error) {
        alert('验证码发送失败，请检查网络后重试。');
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = '获取验证码';
      }
    });
  });
</script>
{% endblock %}
